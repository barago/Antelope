
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Services/Shared/_Layout.cshtml";
}

<script type="text/javascript" src="/Scripts/underscore.js"></script>
<script type="text/javascript" src="/Scripts/backbone.js"></script>

<script type="text/template" id="AnnuaireTemplate">



    <div class="panel panel-default">
        <div class="panel-heading">Annuaire Utilisateurs</div>
        <div class="panel-body">



        </div>

    </div>









</script>

<div id="PrincipalDiv">
</div>


<script type="text/javascript">


    $(document).ready(function () {

        //var currentHSERole = "@ViewBag.CurrentHSERole";

        ResponseModel = Backbone.Model.extend({
            url: '/api/Annuaire/',
            id:0
        });

        AnnuaireModel = Backbone.Model.extend({
        });

        SiteModel = Backbone.Model.extend({
        });

        UtilisateurModel = Backbone.Model.extend({
        });


        UtilisateurCollection = Backbone.Collection.extend({
            model : UtilisateurModel
        });

        SiteCollection = Backbone.Collection.extend({
            model: UtilisateurModel
        });

        responseModel = new ResponseModel();
        //responseModel.set({ "currentHSERole": currentHSERole });

        responseModel.url = '/api/action/Annuaire/GetAnnuaire';
        responseModel.fetch({ async: false, wait: true });

        siteCollection = new SiteCollection(responseModel.get('AllSite'));
        utilisateurCollection = new UtilisateurCollection(responseModel.get('AllUtilisateur'));

        responseModel.set({ 'annuaireModel': new ParametrageModel(responseModel.get('Data')) });
        responseModel.set({ 'siteCollection': siteCollection });
        responseModel.set({ 'utilisateurCollection': utilisateurCollection });

        console.log(responseModel);

        AnnuaireView = Backbone.View.extend({
            id: 'AnnuaireDiv',
            template: _.template($('#AnnuaireTemplate').html()),
            render: function () {
                //console.log(this.model);
                this.$el.html(this.template(this.model.toJSON()));
                return this;
            },
            initialize : function(){

                this.render();
            },
            events: {
                "click #AlimentationBaseTest": "alimentationBaseTest",


            },

        });


        var annuaireView = new AnnuaireView({
            el: $("#PrincipalDiv"),
            model: responseModel
        });





    });


</script>

